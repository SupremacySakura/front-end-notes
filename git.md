# Git初识

## Git初识

***概念***:一个免费开源,分布式的**代码版本**控制系统,帮助开发团队维护代码.

作用:**记录**代码内容,**切换**代码版本,多人开发时高效**合并**代码内容.

## Git安装

***Windows系统***:exe程序,默认下一步即可.

Mac系统:dmg程序,默认下一步即可.

检验成功:

1. 打开bash终端(git专用)
2. 命令:**git-v**(查看版本号)

## Git配置用户信息

配置:用户名和邮箱,应用每次提交代码版本时表明自己的身份.

命令:

git config --global user.name "用户名"

git config --global user.email "用户邮箱"

# Git仓库

## 掌握Git仓库

Git仓库(repository):记录文件**状态**内容的地方,存储着修改的**历史记录**.

创建:

1. 把本地文件夹转换成Git仓库:命令 git init
2. 从其他服务器上克隆Git仓库

# Git的三个区域

Git使用时:

- 工作区:实际**开发**时操作的文件夹
- 暂存区:保存之前的**准备区域**(暂存改动过的文件)
- 版本库:提交并**保存**暂存区中的内容,产生一个版本快照

| 命令                     | 作用                    |
| ------------------------ | ----------------------- |
| git add 文件名           | 暂存指定文件            |
| git add .                | 暂存所有改动的文件      |
| git commit -m "注释说明" | 提交并保存,产生版本快照 |

# Git文件状态

Git文件2种状态:

- 未跟踪:新文件,从未被Git管理过
- 已跟踪:Git已经知道和管理的文件

命令:**git status -s**查看文件状态

第一列是暂存区状态

第二列是工作区状态

| 文件状态  | 概念            | 场景                 |
| --------- | --------------- | -------------------- |
| 未跟踪(U) | 从未被Git管理过 | 新文件               |
| 新添加(A) | 第一次被Git暂存 | 之前版本记录无此文件 |
| 未修改(") | 三个区域统一    | 提交保存后           |
| 已修改(M) | 工作内容变化    | 修改了内容产生       |

# Git暂存区使用

暂存区:暂时存储,可以临时恢复代码内容,与版本库解耦

暂存区→覆盖→工作区,命令:git restore 目标文件(注意:**完全确认覆盖时使用**)

从暂存区移除文件,命令:git rm --catch 目标文件

# 回退版本

概念:把版本库某个版本对应的内容快照,恢复到工作区/暂存区

查看提交历史记录:

git log --oneline

git reflog --oneline

回退命令:

- git reset --soft 版本号(其他文件未跟踪)
- git reset --hard 版本号
- git reset --mixed 版本号 (与git reset 等价)

注意1:只有记录在版本库的提交记录才能恢复

注意2:回退后,继续修改→暂存→提交操作即可(产生新的提交记录过程)

| 工作区 | 暂存区 |        | 版本库 |
| :----: | :----: | :----: | :----: |
|  保留  |  保留  | ←soft  |        |
|  覆盖  |  覆盖  | ←hard  |        |
|  保留  |  覆盖  | ←mixed |        |

# 删除文件

步骤:

1. 手动删除工作区文件
2. 暂存变更/手动删除暂存区文件造成变更
3. 提交保存

# 忽略文件

概念:.gitignore文件可以让git彻底**忽略跟踪**指定文件

目的:让git仓库更小更快,避免重复无意义的文件管理

例如:

1. 系统或软件自动生成的文件
2. 编译产生的结果文件
3. 运行生成时的日志文件,缓存文件,临时文件等
4. 涉密文件,密码,秘钥等文件

创建:

1. 项目根目录新建.gitignore文件
2. 填入相应配置来忽略指定文件

注意:如果文件已经被暂存区跟踪过,可以从暂存区移除即可

```.gitignore
# 忽略npm下载的第三方包
node_modules
# 忽略分发文件
dist
# 忽略VSCode配置文件
.vscode
# 忽略秘钥文件
*.pem
*.cer
# 忽略日志文件
*.log
```

# 分支

## 创建与切换

概念:本质上是指向**提交节点**的可变**指针**,默认名字是master.

注意:HEAD指针影响工作区.暂存区的代码状态.

|      |      |      |      | HEAD   |
| ---- | ---- | ---- | ---- | ------ |
|      |      |      |      | master |
| c1   | c2   | c3   | c4   | c5     |

场景:开发**新需求/修复Bug**,保存主线代码随时可用,多人协同开发提高效率.

例如:

在现有代码上创建新分支完成内容列表业务

突然需要紧急修复Bug - 单独创建分支解决Bug

------

需求:创建内容列表content分支,并产生3次提交记录

步骤:

1. 创建分支命令:**git branch 分支名**
2. 切换分支命令:**git checkedout 分支名**
3. 工作区准备代码并暂存提交,重复3次

## 合并与删除

需求:把login-bug合并回到master分支并删除login-bug分支

步骤:

1. 切回到要合入的分支上:git checkedout master
2. 合并其他分支过来:**git merge login-bug**
3. 删除合并后的分支指针:git branch -d login-bug

## 合并与提交

合并提交:发生于**原分支**产生了**新的提交**记录后,再**合并**回去时发生,自动使用多个快照记录合并后产生一次新的提交,

步骤:

1. 切回到要合入的分支上:git checkedout master
2. 合并其他分支过来:git merge **content**
3. 删除合并后的分支:git branch -d content

注意:提交记录的顺序按照产生的顺序排列,而非合并的先后顺序.

## 合并冲突

概念:**不同分支**中,对同一个文件的**同一部分**修改,Git无法干净的合并,产生合并冲突.

解决:

1. 打开VSCode找到冲突文件并手动解决
2. 解决后需要提交一次记录

避免:

1. 按页面划分不同分支开发
2. 公共代码在同一文件夹维护
3. Node等软件版本统一,npm包统一下载

# Git常用命令

| 命令                         | 作用                                 | 注意                                                         |
| ---------------------------- | ------------------------------------ | ------------------------------------------------------------ |
| git -v                       | 查看git版本                          |                                                              |
| **git init**                 | 初始化git仓库                        |                                                              |
| git add 文件标识             | 暂存某个文件                         | 标识是以终端为起始的相对路径                                 |
| **git add .**                | 暂存所有文件                         |                                                              |
| **git commit -m "说明注释"** | 提交产生版本记录                     | 某次提交,把暂存区内容快照一份                                |
| git status                   | 查看文件状态 - 详细信息              |                                                              |
| git status -s                | 查看文件状态 - 简略信息              | 第一列是暂存区状态,第二列是工作区状态                        |
| git ls-files                 | 查看暂存区文件列表                   |                                                              |
| git restore 文件标识         | 从暂存区文件列表                     | 如果文件标识为.则恢复所有文件                                |
| git rm --cached 文件标识     | 从暂存区移除文件                     | 不让git跟踪文件变化                                          |
| git log                      | 查看提交记录 - 详细信息              |                                                              |
| **git log --oneline**        | 查看提交记录 - 简略信息              | 版本号 分支指针 提交时说明注释                               |
| **git reflog --oneline**     | 查看完整历史 - 简略消息              | 包括提交,切换,回退等所有记录                                 |
| git reset 版本号             | 切换版本代码到暂存区和工作区         | --soft模式保留暂存区和工作区原本内容;                                                                                                 --hard模式不保留工作区和暂存区原本内容;                                                                                              --mixed模式不保留暂存区,工作区保留(默认)先覆盖到暂存区,再用暂存区对比覆盖工作区 |
| **git branch 分支名**        | 创建分支                             |                                                              |
| git branch                   | 查看本地分支                         |                                                              |
| git branch -d 分支名         | 删除分支                             | 请确保记录已经合并到别的分支下,再删除分支                    |
| **git checkout 分支名**      | 切换分支                             |                                                              |
| git checkout -b 分支名       | 创建并立刻切换分支                   |                                                              |
| **git merge 分支名**         | 把分支提交历史记录合并到当前所在分支 |                                                              |

# 远程仓库

## 远程仓库-链接与上传

概念:托管在因特网或其他网络中的你的项目的版本库.

作用:保存版本库的历史记录,多人协作.

创建:公司自己的服务器/第三方托管平台(Gitee,Gitlab,GitHub...)

需求:创建远程版本库,并把本地Git仓库推送上去保存.

步骤:

1. 注册地三方托管平台网站账号
2. 新建仓库得到**远程仓库Git地址**
3. 本地Git仓库**添加**远程仓库原点地址
4. 本地Git仓库**推送**版本记录到远程仓库
   - 命令:git remote add 远程仓库别名 远程仓库地址
   - 例如:git remote add origin http://gitee.com/lidongxu/work.git
   - 命令:git push -u 远程仓库别名 本地和远程分支名
   - 例如:git push -u origin master
   - 完整写法:git push --set-upstream origin master:master

## 远程仓库-克隆

克隆:拷贝一个Git仓库到本地,进行使用.

命令:git clone 远程仓库地址,例如:git clone http://gitee.com/lidongxu/work.git

效果:在运行命令所在文件夹,生成work项目文件夹(包含版本库,并映射到暂存区和工作区)

注意1:Git本地仓库已经建立好和远程仓库的链接

注意2:仓库公开随意克隆,推送需要身为仓库团队成员

# 多人协同开发

需求:小传新代码共享给小智.

步骤：

1. 小传开发代码→工作区→暂存区→提交→拉取(可选)→推送
2. 小智→拉取(后续也可以开发代码→...→推送)
3. 想要看到别人同步上去的最新内容:git pull origin master等价于:
   - git fetch origin master:master(获取远程分支记录到本地,未合并)
   - git merge origin/master(把远程分支记录合并到所在分支下)

# 命令总结

| 命令                                         | 作用             | 注意                                                         |
| -------------------------------------------- | ---------------- | ------------------------------------------------------------ |
| **git remote add 远程仓库别名 远程仓库地址** | 添加远程仓库地址 | 别名唯一,地址.git结尾的网址                                  |
| git remote -v                                | 查看远程仓库地址 |                                                              |
| git remote remove 远程仓库别名               | 删除远程仓库地址 |                                                              |
| **git pull 远程仓库别名 分支名**             | 拉取             | 完整写法:git pull 远程仓库别名 远程分支名:本地分支名                                       等价于:git fetch 和git merge |
| **git push 远程仓库别名 分支名**             | 推送             | 完整写法:git push 远程仓库别名 远程分支名:本地分支名                                        -u:建立通道后以后可以简写git push |
| git pull --rebase 远程仓库别名 分支名        | 拉取合并         | 合并没有关系的记录                                           |
| **git clone 远程仓库地址**                   | 克隆             | 从0得到一个远程Git仓库到本地使用                             |

